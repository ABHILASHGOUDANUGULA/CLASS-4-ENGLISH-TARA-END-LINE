<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Interactive Story with Pronunciation</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.8;
    font-size: 20px;
    padding: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.container {
    max-width: 900px;
    margin: 0 auto;
}

h1 {
    text-align: center;
    color: white;
    font-size: 42px;
    margin-bottom: 10px;
    text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
    font-weight: bold;
}

.credits {
    text-align: center;
    color: white;
    font-size: 18px;
    margin-bottom: 40px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
    font-style: italic;
    background: rgba(255, 255, 255, 0.1);
    padding: 10px 20px;
    border-radius: 10px;
    display: inline-block;
    margin-left: 50%;
    transform: translateX(-50%);
}

.story-container {
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    padding: 30px;
    border-radius: 20px;
    margin-bottom: 30px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    transition: transform 0.3s ease;
}

.story-container:hover {
    transform: translateY(-5px);
}

.story-container:nth-child(2) {
    background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
}

.story-container:nth-child(3) {
    background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
}

.story-container:nth-child(4) {
    background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
}

.story-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px 25px;
    border-radius: 12px;
    margin-bottom: 25px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.story-header:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

.story-header h2 {
    font-size: 28px;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.button-container {
    text-align: center;
    margin-bottom: 20px;
}

.play-button {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    border: none;
    padding: 15px 40px;
    font-size: 20px;
    font-weight: bold;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 10px;
}

.play-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

.play-button.playing {
    background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
    animation: pulse-button 1.5s infinite;
}

@keyframes pulse-button {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.story-text {
    color: #2d3748;
    text-align: justify;
    font-size: 20px;
    line-height: 1.9;
}

.word {
    cursor: pointer;
    padding: 3px 5px;
    border-radius: 4px;
    transition: all 0.2s ease;
    display: inline-block;
}

.word:hover {
    background-color: rgba(255, 255, 0, 0.6);
    transform: scale(1.05);
}

.word.clicked {
    background-color: rgba(255, 165, 0, 0.7);
    font-weight: bold;
}

.word.reading {
    background-color: rgba(50, 205, 50, 0.7);
    font-weight: bold;
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.7;
    }
}

.icon {
    font-size: 24px;
}
</style>
</head>
<body>

<div class="container">
    <h1>üìñ Tara Reading - Class 4 üìñ</h1>
    <div class="credits">Created by A.Abhilash Goud (PRT) KV Nizamabad</div>
    
    <div id="stories"></div>
</div>

<script>
const stories = [
    {
        title: "The Fox and the Crow",
        text: `A crow sat in a tall tree holding a tasty bit of cheese in her mouth. Along came a hungry pig. He thought the crow would laugh at his funny face and drop the cheese. He called to the crow, making a funny face. But she didn't even smile. The big brown bear called to the crow, asking her to drop the cheese. He promised a pot of sugar in return. But the crow did not like sugar. And she did not drop the cheese. Along came a hungry elephant. He told the crow to drop the cheese or he would give her a bath. But the crow did not drop the cheese, even though the elephant's long nose sent up a fountain of water. The crow was about to eat the cheese when along came a wild fox. The fox called to the crow, telling her she was beautiful.`
    },
    {
        title: "Three Dreams",
        text: `Once, in Spain, there were three men who were very poor. After going without food for three days, they thought they would spend all the money they had on a chicken. They bought one and cooked it over a fire. One of them suggested that they keep the chicken until the next morning. That night, they would dream and the one who dreamed of going the farthest would eat it all. The other two thought it was a good idea, and at nightfall, they all lay down. But the first man waited until the other two were asleep. Then he got up and ate the chicken before going back to sleep. In the morning, the three men woke up and started to talk about their dreams. One of them said that he had dreamed he went to France. Another one said that he had gone farther and dreamed he went to Germany.`
    },
    {
        title: "Why Does Glass Break?",
        text: `What happens when you put cold water into a hot glass? The same thing that happens when you put hot water into a cold glass ‚Äî it breaks! But do you know something? If you use a very thin glass, it will not break even if you put hot water into it when it is cold or cold water into it when it is hot! Scientists use tubes made of very thin glass called test tubes. They can be put on the fire. Water can be boiled in them ‚Äî they do not break. Think of two glasses, one thick, one thin. Boiling water is put into them. Which one breaks? The thick one! Let us see why. Hot water is put into the thick glass. The inside of the glass grows hot. It expands, that is, it grows bigger. The outside is not yet hot, so it stays the same size.`
    }
];

let currentReadingStory = null;
let isReading = false;
let currentWordIndex = 0;
let storyWords = [];
let readingTimeout;

const storiesDiv = document.getElementById('stories');

// Create story containers
stories.forEach((story, storyIndex) => {
    const storyContainer = document.createElement('div');
    storyContainer.className = 'story-container';
    
    // Story header (clickable)
    const storyHeader = document.createElement('div');
    storyHeader.className = 'story-header';
    storyHeader.innerHTML = `<h2>${story.title}</h2>`;
    storyHeader.onclick = function() {
        speakText(story.title);
    };
    
    // Button container
    const buttonContainer = document.createElement('div');
    buttonContainer.className = 'button-container';
    
    const playButton = document.createElement('button');
    playButton.className = 'play-button';
    playButton.id = `play-btn-${storyIndex}`;
    playButton.innerHTML = `<span class="icon">‚ñ∂Ô∏è</span><span>Play Story</span>`;
    playButton.onclick = function() {
        toggleReading(storyIndex);
    };
    
    buttonContainer.appendChild(playButton);
    
    // Story text
    const storyText = document.createElement('div');
    storyText.className = 'story-text';
    storyText.id = `story-${storyIndex}`;
    
    storyContainer.appendChild(storyHeader);
    storyContainer.appendChild(buttonContainer);
    storyContainer.appendChild(storyText);
    storiesDiv.appendChild(storyContainer);
    
    // Split text into words and wrap each word in span
    const words = [];
    story.text.split(/(\s+)/).forEach((word, wordIndex) => {
        if (word.trim().length > 0 && !word.match(/^\s+$/)) {
            const span = document.createElement('span');
            span.textContent = word;
            span.className = 'word';
            span.dataset.storyIndex = storyIndex;
            
            // Single click for pronunciation
            span.onclick = function(e) {
                e.stopPropagation();
                const cleanWord = word.replace(/[.,!?]/g, "");
                if (!isReading && cleanWord) {
                    speakText(cleanWord);
                    this.classList.add('clicked');
                    const element = this;
                    setTimeout(() => element.classList.remove('clicked'), 500);
                }
            };
            
            storyText.appendChild(span);
            words.push({
                element: span,
                text: word.replace(/[.,!?]/g, "")
            });
        } else {
            storyText.appendChild(document.createTextNode(word));
        }
    });
    
    story.wordElements = words;
});

function speakText(text) {
    if (!text || text.trim() === '') return;
    
    // Cancel any ongoing speech
    if (window.speechSynthesis.speaking) {
        window.speechSynthesis.cancel();
    }
    
    // Small delay to ensure cancellation completes
    setTimeout(() => {
        const utterance = new SpeechSynthesisUtterance(text.trim());
        utterance.rate = 1.0;
        utterance.pitch = 1;
        utterance.lang = 'en-US';
        utterance.volume = 1;
        
        window.speechSynthesis.speak(utterance);
    }, 100);
}

function toggleReading(storyIndex) {
    const playButton = document.getElementById(`play-btn-${storyIndex}`);
    
    if (currentReadingStory === storyIndex && isReading) {
        // Stop reading
        stopReading();
        playButton.innerHTML = `<span class="icon">‚ñ∂Ô∏è</span><span>Play Story</span>`;
        playButton.classList.remove('playing');
    } else {
        // Stop any current reading
        if (isReading) {
            stopReading();
            const oldButton = document.getElementById(`play-btn-${currentReadingStory}`);
            oldButton.innerHTML = `<span class="icon">‚ñ∂Ô∏è</span><span>Play Story</span>`;
            oldButton.classList.remove('playing');
        }
        
        // Start reading this story
        currentReadingStory = storyIndex;
        storyWords = stories[storyIndex].wordElements;
        currentWordIndex = 0;
        isReading = true;
        playButton.innerHTML = `<span class="icon">‚è∏Ô∏è</span><span>Stop Story</span>`;
        playButton.classList.add('playing');
        readNextWord();
    }
}

function readNextWord() {
    if (!isReading || currentWordIndex >= storyWords.length) {
        stopReading();
        if (currentReadingStory !== null) {
            const playButton = document.getElementById(`play-btn-${currentReadingStory}`);
            playButton.innerHTML = `<span class="icon">‚ñ∂Ô∏è</span><span>Play Story</span>`;
            playButton.classList.remove('playing');
        }
        return;
    }
    
    // Remove previous highlight
    if (currentWordIndex > 0) {
        storyWords[currentWordIndex - 1].element.classList.remove('reading');
    }
    
    // Highlight current word
    const currentWord = storyWords[currentWordIndex];
    currentWord.element.classList.add('reading');
    currentWord.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
    
    // Speak the word
    const utterance = new SpeechSynthesisUtterance(currentWord.text);
    utterance.rate = 1.1;
    utterance.pitch = 1;
    utterance.lang = 'en-US';
    
    utterance.onend = function() {
        currentWord.element.classList.remove('reading');
        currentWordIndex++;
        readingTimeout = setTimeout(readNextWord, 0);
    };
    
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utterance);
}

function stopReading() {
    isReading = false;
    window.speechSynthesis.cancel();
    clearTimeout(readingTimeout);
    
    // Remove all reading highlights
    if (storyWords.length > 0) {
        storyWords.forEach(word => {
            word.element.classList.remove('reading');
        });
    }
}
</script>

</body>
</html>
